# Default system properties included when running spark-submit

# Spark executor and driver memory
spark.driver.memory 2g
spark.executor.memory 4g

# Executor settings
spark.executor.instances 2
spark.executor.cores 2

# Dynamic allocation settings
spark.dynamicAllocation.enabled true
spark.dynamicAllocation.initialExecutors 2
spark.dynamicAllocation.minExecutors 1
spark.dynamicAllocation.maxExecutors 10
spark.dynamicAllocation.executorIdleTimeout 60s

# Shuffle service for dynamic allocation
spark.shuffle.service.enabled true

# Speculative execution
spark.speculation true
spark.speculation.interval 1000ms
spark.speculation.multiplier 1.5
spark.speculation.quantile 0.75

# Memory and storage settings
spark.memory.fraction 0.6
spark.memory.storageFraction 0.5
spark.storage.level MEMORY_AND_DISK_SER
spark.rdd.compress true

# Serialization
spark.serializer org.apache.spark.serializer.KryoSerializer
spark.kryo.registrationRequired false
spark.kryo.unsafe true

# Event logging for History Server
spark.eventLog.enabled true
spark.eventLog.dir /tmp/spark-events
spark.history.fs.logDirectory /tmp/spark-events

# Metrics
spark.metrics.conf /opt/bitnami/spark/conf/metrics.properties

# Prometheus integration
spark.metrics.conf.*.sink.prometheusServlet.class org.apache.spark.metrics.sink.PrometheusServlet
spark.metrics.conf.*.sink.prometheusServlet.path /metrics
spark.ui.prometheus.enabled true
spark.executor.processTreeMetrics.enabled true

# UI settings
spark.ui.port 4040
spark.ui.retainedJobs 100
spark.ui.retainedStages 100
spark.ui.retainedTasks 10000
spark.worker.ui.retainedExecutors 100
spark.worker.ui.retainedDrivers 100
spark.sql.ui.retainedExecutions 100

# SQL settings
spark.sql.adaptive.enabled true
spark.sql.adaptive.coalescePartitions.enabled true
spark.sql.adaptive.skewJoin.enabled true
spark.sql.adaptive.localShuffleReader.enabled true
spark.sql.shuffle.partitions 100

# Network timeout settings
spark.network.timeout 120s
spark.executor.heartbeatInterval 10s
spark.storage.blockManagerSlaveTimeoutMs 60000
spark.shuffle.io.connectionTimeout 60s
spark.shuffle.io.retryWait 5s
spark.shuffle.io.maxRetries 3

# Kubernetes specific settings
spark.kubernetes.allocation.batch.size 5
spark.kubernetes.allocation.batch.delay 1s